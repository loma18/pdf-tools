# 书签文件功能使用说明

## 功能概述

新增了使用书签文件进行精确匹配的功能，允许用户提供预先制作的书签文件（JSON、TXT、CSV格式），程序将根据文件中的标题在PDF中进行精确匹配，而不是使用自动识别算法。

## 支持的书签文件格式

### 1. JSON 格式（推荐）

```json
[
  {
    "title": "1. 规范概述",
    "level": 1,
    "page": 1
  },
  {
    "title": "1.1 编写目的", 
    "level": 2,
    "page": 1
  }
]
```

- `title`: 书签标题（必需）
- `level`: 书签层级（可选，默认为1）
- `page`: 页面号（可选，用于参考）

### 2. TXT 格式

```
PDF书签列表
==================================================

1. 规范概述
  1.1 编写目的 (层级 2, 页面 1)
  1.2 适用范围 (层级 2, 页面 1)
    1.2.1 适用人群 (层级 3, 页面 1)
```

- 使用缩进（两个空格）表示层级
- 可在括号中包含层级和页面信息

### 3. CSV 格式

```csv
title,level,page
1. 规范概述,1,1
1.1 编写目的,2,1
1.2 适用范围,2,1
```

- 第一行为标题行
- `title` 列必需，`level` 和 `page` 列可选

## 使用方法

### 界面操作

1. 打开PDF书签工具
2. 在"自动加书签"页面中：
   - 选择要处理的PDF文件
   - **可选：选择书签文件** - 点击"书签文件（可选）"旁的"浏览..."按钮
   - 设置输出文件路径
   - 点击"开始处理"

### 命令行操作

```bash
# 使用书签文件进行精确匹配
python pdf_bookmark_tool.py input.pdf --bookmark-file bookmarks.json -o output.pdf

# 不使用书签文件，使用自动识别
python pdf_bookmark_tool.py input.pdf -o output.pdf
```

## 匹配机制

1. **精确匹配优先**：首先尝试与PDF中的文本进行精确匹配
2. **模糊匹配**：如果精确匹配失败，启用基于相似度的模糊匹配（相似度阈值80%）
3. **标题清理**：自动移除标点符号和多余空格以提高匹配成功率

## 匹配日志

处理过程中会显示详细的匹配日志：

```
✅ 匹配成功: '1. 规范概述' -> 页面 1
✅ 匹配成功: '1.1 编写目的' -> 页面 1
❌ 未找到匹配: '某个不存在的标题'
```

## 优势

1. **精确控制**：完全控制书签的内容和层级结构
2. **提高准确性**：避免自动识别可能产生的误判
3. **批量处理**：可以为多个相似PDF使用同一套书签模板
4. **格式灵活**：支持多种常见的文件格式

## 注意事项

1. 书签文件中的标题需要与PDF中的实际文本内容保持一致
2. 如果提供了书签文件，将不会使用原有的自动识别算法
3. 未匹配成功的标题将不会被添加到PDF书签中
4. 层级信息将完全按照书签文件中的设置执行

## 获取书签文件

可以通过以下方式获取书签文件：

1. **从现有PDF提取**：使用"自动提取书签"功能从已有书签的PDF中导出
2. **手动创建**：根据PDF目录手动创建符合格式的书签文件
3. **模板复用**：为相同系列的文档使用相同的书签模板 