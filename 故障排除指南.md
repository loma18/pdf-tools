# PDF书签工具故障排除指南

## 常见问题及解决方案

### 🚨 错误：spawn C:\WINDOWS\system32\cmd.exe ENOENT

这是最常见的错误，通常在GitHub Actions构建的exe文件中出现。

#### 问题原因

1. **Python环境缺失**：用户电脑上未安装Python或Python未添加到系统PATH
2. **路径解析错误**：打包后的应用无法正确找到Python后端文件
3. **Python命令不可用**：系统中没有可用的`python`或`python3`命令

#### 解决方案

##### 方案一：安装Python环境（推荐）

1. **下载Python**
   - 访问 [Python官网](https://www.python.org/downloads/)
   - 下载Python 3.7或更高版本
   - **重要**：安装时勾选"Add Python to PATH"选项

2. **验证安装**
   ```cmd
   python --version
   # 或者
   python3 --version
   ```

3. **安装依赖**
   ```cmd
   pip install PyMuPDF python-dotenv
   ```

##### 方案二：使用便携版Python

如果无法修改系统PATH，可以：

1. 下载Python便携版
2. 将Python可执行文件放在应用同目录下
3. 重命名为`python.exe`

##### 方案三：使用诊断工具

1. 打开PDF书签工具
2. 点击底部的"环境诊断"按钮
3. 查看详细的环境检查结果
4. 根据提示解决相应问题

#### 技术细节

**错误代码**：`ENOENT`表示"文件或目录不存在"

**具体原因**：
- 应用尝试执行`spawn("python", args)`
- 系统在PATH中找不到`python`命令
- 导致子进程创建失败

**修复内容**（v3.1.0+）：
- 添加了Python可用性检查
- 改进了错误提示信息
- 支持`python`和`python3`命令自动切换
- 添加了详细的诊断功能

### 🔧 其他常见问题

#### 问题：文件路径错误

**现象**：提示"Python脚本不存在"

**解决方案**：
1. 重新下载完整的安装包
2. 确保extraResources正确打包
3. 检查防病毒软件是否误删文件

#### 问题：权限问题

**现象**：无法写入输出文件

**解决方案**：
1. 以管理员身份运行应用
2. 选择有写权限的输出目录
3. 检查文件是否被占用

#### 问题：中文路径问题

**现象**：处理包含中文的路径失败

**解决方案**：
1. 尝试使用英文路径
2. 确保系统编码设置正确
3. 更新到最新版本

### 📊 使用诊断工具

应用内置了环境诊断功能：

1. **位置**：应用底部的"环境诊断"按钮
2. **功能**：
   - 检查Python环境
   - 验证文件路径
   - 显示详细配置信息
   - 提供解决方案建议

3. **诊断信息说明**：
   - ✅ 绿色：正常
   - ⚠️ 黄色：警告
   - ❌ 红色：错误

### 🛠️ 开发者信息

#### 构建配置

```json
{
  "extraResources": [
    {
      "from": "python-backend/",
      "to": "python-backend/"
    }
  ]
}
```

#### 路径解析逻辑

```javascript
function getPythonBackendPath() {
  if (process.env.NODE_ENV === 'development' || !app.isPackaged) {
    return path.join(__dirname, "../python-backend");
  }
  return path.join(process.resourcesPath, "python-backend");
}
```

### 📞 获取支持

如果以上方案都无法解决问题：

1. **收集诊断信息**：点击"环境诊断" → "复制诊断信息"
2. **创建Issue**：在GitHub项目页面提交问题
3. **包含信息**：
   - 操作系统版本
   - 应用版本
   - 完整的错误信息
   - 诊断信息内容

### 📝 更新日志

#### v3.1.0
- ✅ 修复spawn ENOENT错误
- ✅ 添加Python环境检查
- ✅ 改进错误提示信息
- ✅ 新增环境诊断功能
- ✅ 支持python/python3命令自动切换

#### v3.0.0
- 初始版本
- 已知问题：Python环境检查不完善

---

**最后更新**：2024年12月
**版本要求**：PDF书签工具 v3.1.0+ 