# PDF自动书签工具

这是一个Python工具，可以自动为PDF文件添加书签。工具会智能识别PDF中的目录结构，只针对目录条目添加书签，不会对普通段落添加书签。

## 功能特性

- 🔍 **智能目录识别** - 自动识别PDF中的目录结构
- 📑 **多格式支持** - 支持各种中文目录格式（第X章、X.X、一、等）
- 🎯 **深层级支持** - 支持最多8层深度的标题结构（如2.6.2.1.1.1.1.1）
- 🔄 **严格逻辑验证** - 多重验证确保目录结构完全合理
  - **顶层连续性验证**：顶层数字必须连续（1、2、3...）
  - **父子一致性验证**：子级必须包含父级完整数字前缀
  - **排序验证**：确保同层级数字严格递增
  - **前瞻性分析**：基于后续条目判断合理性
  - **深层级智能策略**：对5层以上标题采用适度宽松验证
- 📖 **自动书签** - 自动添加分层书签到PDF文件
- ⚡ **批量处理** - 支持命令行批量处理
- 🧹 **智能去重** - 自动过滤重复和不合理的条目

## 支持的目录格式

工具可以识别以下目录格式：

### 中文格式
- 第X章、第X节、第X部分
- 一、标题、二、标题（中文数字）
- （1）标题、（2）标题

### 数字编号格式（支持最多8层）
- 1. 标题、2. 标题
- 1.1 标题、1.2 标题
- 1.1.1 标题、1.1.2 标题
- 1.1.1.1 标题、1.1.1.2 标题
- 1.1.1.1.1 标题（支持到8层深度）
- 1、标题、2、标题

### 字母和罗马数字格式
- I、标题、II、标题（罗马数字）
- A. 标题、B. 标题
- a) 标题、b) 标题
- (1) 标题、(2) 标题

### 特殊格式
- 【标题】格式

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本用法

```bash
# 处理PDF文件（覆盖原文件）
python pdf_bookmark_tool.py your_document.pdf

# 处理PDF文件并保存到新文件
python pdf_bookmark_tool.py your_document.pdf -o output_with_bookmarks.pdf
```

### 命令行参数

- `input_pdf`: 输入的PDF文件路径（必需）
- `-o, --output`: 输出PDF文件路径（可选，默认覆盖原文件）

### 使用示例

```bash
# 示例1：处理学术论文
python pdf_bookmark_tool.py 学术论文.pdf -o 学术论文_带书签.pdf

# 示例2：处理技术文档
python pdf_bookmark_tool.py 技术手册.pdf

# 示例3：处理教材
python pdf_bookmark_tool.py 教材.pdf -o 教材_书签版.pdf
```

## 验证规则

工具采用严格的多重验证确保书签结构的逻辑合理性：

### 1. 顶层连续性验证
- 顶层数字必须连续（如1、2、3、4、5...）
- 不连续的数字将被过滤（如跳过6直接到10）
- 支持从任意数字开始，但必须保持连续性

### 2. 父子一致性验证
- 子级必须包含父级的完整数字前缀
- ✅ 正确：1.2 → 1.2.1 → 1.2.1.1
- ❌ 错误：1.2 → 3.1（子级未包含父级前缀）

### 3. 数字递增验证
- 同层级数字必须严格递增
- ✅ 正确：1.1、1.2、1.3
- ❌ 错误：1.1、1.3、1.2（顺序错误）

### 4. 深层级智能策略
- 对5层以上标题采用更宽松的验证
- 允许适度的重复以避免过度过滤
- 支持最多8层深度的复杂结构

## 工作原理

1. **文本提取**: 使用PyMuPDF提取PDF中的文本和字体信息
2. **目录识别**: 通过正则表达式匹配各种目录格式
3. **多重验证**: 按顺序执行顶层连续性→父子一致性→排序验证
4. **层级分析**: 根据格式特征确定目录层级
5. **智能过滤**: 自动去除不符合逻辑规则的条目
6. **书签生成**: 创建分层书签结构并嵌入PDF

## 注意事项

- 工具主要针对包含结构化目录的PDF文档
- 对于图片扫描版PDF，可能需要先进行OCR处理
- 建议在处理重要文档前先备份原文件
- 某些加密或受保护的PDF可能无法处理

## 技术依赖

- **PyMuPDF**: PDF文档处理
- **pdfplumber**: 文本提取和分析
- **re**: 正则表达式匹配

## 许可证

本项目采用MIT许可证。

## 贡献

欢迎提交问题报告和功能请求！如果您想贡献代码，请fork本项目并提交pull request。 