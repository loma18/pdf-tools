# PDF自动书签工具

这是一个强大的Python工具，可以自动为PDF文件添加书签。工具采用**传统规则+AI语义过滤**的混合架构，智能识别PDF中的目录结构，只针对真实的标题添加书签，不会对普通段落、表格内容添加书签。

## ✨ 功能特性

### 🎯 核心功能
- 🔍 **智能目录识别** - 自动识别PDF中的目录结构
- 📑 **多格式支持** - 支持各种中文目录格式（第X章、X.X、一、等）
- 🎯 **深层级支持** - 支持最多8层深度的标题结构（如2.6.2.1.1.1.1.1）
- 📖 **自动书签** - 自动添加分层书签到PDF文件，支持正确的页面跳转
- ⚡ **批量处理** - 支持命令行批量处理

### 🧠 AI智能过滤
- 🤖 **大模型语义过滤** - 使用GPT-4进行高级语义理解和结构优化
- 🚫 **表格内容过滤** - 自动识别并过滤表格中的编号内容
- 🔧 **智能预过滤** - 基于规则的快速预过滤，去除明显的非标题内容
- 🧹 **智能去重** - 自动过滤重复和不合理的条目
- 📊 **调试支持** - 保存详细的过滤过程数据到JSON文件

### 🔄 严格逻辑验证
- **顶层连续性验证**：顶层数字必须连续（1、2、3...）
- **父子一致性验证**：子级必须包含父级完整数字前缀
- **排序验证**：确保同层级数字严格递增
- **前瞻性分析**：基于后续条目判断合理性
- **深层级智能策略**：对5层以上标题采用适度宽松验证

### 🖥️ 用户界面
- 🎨 **现代GUI界面** - 基于tkinter的美观图形界面
- 📝 **实时日志显示** - 处理过程实时可见
- ⚙️ **灵活配置选项** - 支持字体大小阈值等参数调整
- 🚀 **一键启动** - 提供批处理文件和启动器

## 📋 支持的目录格式

工具可以识别以下目录格式：

### 中文格式
- 第X章、第X节、第X部分
- 一、标题、二、标题（中文数字）
- （1）标题、（2）标题

### 数字编号格式（支持最多8层）
- 1. 标题、2. 标题
- 1.1 标题、1.2 标题
- 1.1.1 标题、1.1.2 标题
- 1.1.1.1 标题、1.1.1.2 标题
- 1.1.1.1.1 标题（支持到8层深度）
- 1、标题、2、标题

### 字母和罗马数字格式
- I、标题、II、标题（罗马数字）
- A. 标题、B. 标题
- a) 标题、b) 标题
- (1) 标题、(2) 标题

### 特殊格式
- 【标题】格式

## 🚀 快速开始

### 方式一：使用GUI界面（推荐）

```bash
# Windows用户双击运行
run_gui.bat

# 或者直接运行
python start_gui.py
```

### 方式二：命令行使用

```bash
# 基本用法
python pdf_bookmark_tool.py your_document.pdf

# 指定输出文件
python pdf_bookmark_tool.py your_document.pdf -o output_with_bookmarks.pdf

# 设置字体大小阈值
python pdf_bookmark_tool.py your_document.pdf --font-threshold 12
```

## 📦 安装依赖

### 自动安装（推荐）
运行启动器会自动检查并安装依赖：
```bash
python start_gui.py
```

### 手动安装
```bash
pip install -r requirements.txt
```

## 📖 使用方法

### GUI界面使用

1. **启动程序**：双击 `run_gui.bat` 或运行 `python start_gui.py`
2. **选择文件**：点击"浏览"按钮选择PDF文件
3. **配置选项**：
   - 启用/禁用字体大小过滤
   - 设置字体大小阈值（可选）
4. **开始处理**：点击"开始处理"按钮
5. **查看结果**：在日志区域查看处理进度和结果

### 命令行参数

- `input_pdf`: 输入的PDF文件路径（必需）
- `-o, --output`: 输出PDF文件路径（可选，默认添加_bookmarked后缀）
- `--font-threshold`: 手动设置字体大小阈值（可选）

### 使用示例

```bash
# 示例1：处理学术论文
python pdf_bookmark_tool.py 学术论文.pdf -o 学术论文_带书签.pdf

# 示例2：处理技术文档（自动生成输出文件名）
python pdf_bookmark_tool.py 技术手册.pdf

# 示例3：设置字体阈值处理教材
python pdf_bookmark_tool.py 教材.pdf --font-threshold 12
```

## 🔧 工作原理

### 处理流程
1. **文本提取**: 使用PyMuPDF提取PDF中的文本和字体信息
2. **基础过滤**: 基于字体大小和格式特征进行初步筛选
3. **预过滤**: 过滤表格内容和非标准前缀文本
4. **AI语义过滤**: 使用大模型进行高级语义理解和结构优化
5. **逻辑验证**: 多重验证确保目录结构的逻辑合理性
6. **书签生成**: 创建分层书签结构并嵌入PDF

### 混合架构优势
- **传统规则**：快速处理基础格式识别和物理特征过滤
- **AI语义**：深度理解文档语义，过滤碎片化和无意义文本
- **双重保障**：确保既有高准确率又有良好的处理速度

## 🛡️ 验证规则

工具采用严格的多重验证确保书签结构的逻辑合理性：

### 1. 表格内容过滤
- 自动识别表格环境中的编号文本
- 过滤包含工具名称、技术术语的编号条目
- 检测并排除功能描述类文本

### 2. 顶层连续性验证
- 顶层数字必须连续（如1、2、3、4、5...）
- 不连续的数字将被过滤（如跳过6直接到10）
- 支持从任意数字开始，但必须保持连续性

### 3. 父子一致性验证
- 子级必须包含父级的完整数字前缀
- ✅ 正确：1.2 → 1.2.1 → 1.2.1.1
- ❌ 错误：1.2 → 3.1（子级未包含父级前缀）

### 4. 数字递增验证
- 同层级数字必须严格递增
- ✅ 正确：1.1、1.2、1.3
- ❌ 错误：1.1、1.3、1.2（顺序错误）

### 5. 深层级智能策略
- 对5层以上标题采用更宽松的验证
- 允许适度的重复以避免过度过滤
- 支持最多8层深度的复杂结构

## 📁 项目结构

```
pdf-tools/
├── pdf_bookmark_tool.py    # 核心处理引擎
├── pdf_bookmark_gui.py     # GUI界面
├── start_gui.py           # 启动器（自动检查依赖）
├── run_gui.bat           # Windows批处理启动脚本
├── requirements.txt      # 依赖包列表
└── README.md            # 项目文档
```

## ⚠️ 注意事项

- 工具主要针对包含结构化目录的PDF文档
- 对于图片扫描版PDF，可能需要先进行OCR处理
- 建议在处理重要文档前先备份原文件
- 某些加密或受保护的PDF可能无法处理
- AI语义过滤需要网络连接（使用内部GPT-4接口）

## 🛠️ 技术依赖

- **PyMuPDF**: PDF文档处理和书签操作
- **pdfplumber**: 文本提取和分析
- **tkinter**: GUI界面框架
- **requests**: HTTP请求（AI接口调用）
- **re**: 正则表达式匹配
- **threading**: 多线程处理

## 🎯 适用场景

- 📚 **学术论文**: 自动为论文添加章节书签
- 📖 **技术文档**: 为API文档、用户手册添加导航
- 📝 **报告文档**: 为分析报告、研究报告添加目录书签
- 📋 **规范文档**: 为标准规范、操作手册添加结构化书签

## 🤝 贡献

欢迎提交问题报告和功能请求！如果您想贡献代码，请fork本项目并提交pull request。

## 📄 许可证

本项目采用MIT许可证。 